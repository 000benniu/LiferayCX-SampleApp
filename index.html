<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700;800&family=Merriweather+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet">
  <title>SaaSã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º</title>
  <link href="/css/index.css" rel="stylesheet">
</head>

<body>
  <div class="parent-container">
      <div class="container">
          <h2>Liferay SaaSã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º</h2>
          

          <!-- OAuth2èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ  -->
          <div id="oauth2AuthForm" class="input-section">
              <h3>Liferay SaaS OAuth2è¨­å®š</h3>
              
              <div class="oauth2-reference">
                  <a href="https://learn.liferay.com/ja/w/dxp/headless-delivery/using-oauth2/creating-oauth2-applications" target="_blank" rel="noopener noreferrer">
                      Liferay OAuth2ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã‚¬ã‚¤ãƒ‰
                  </a>
                  <div class="help-text">
                  <p><strong>Liferay SaaS OAuth2è¨­å®šæ‰‹é †:</strong></p>
                  <ol>
                      <li>Liferay SaaSç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³</li>
                      <li>Control Panel â†’ Configuration â†’ OAuth2 Administration</li>
                      <li>æ–°ã—ã„OAuth2ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ</li>
                      <li>Client Profile: Web Application</li>
                      <li>Grant Types: Client Credentials</li>
                      <li>é©åˆ‡ãªã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¨­å®šï¼ˆLiferay.Headless.Admin.User.everythingï¼‰</li>
                  </ol>
              </div>
              </div>
              
              <div class="form-group">
                  <label for="liferaySaasUrl">Liferay SaaS URL:</label>
                  <input type="url" id="liferaySaasUrl" placeholder="https://your-company.liferay.cloud" />
                  <small class="field-help">ä¾‹: https://your-company.liferay.cloud</small>
              </div>
              
              <div class="form-group">
                  <label for="clientId">Client ID:</label>
                  <input type="text" id="clientId" placeholder="OAuth2 Client IDã‚’å…¥åŠ›" />
              </div>
              <div class="form-group">
                  <label for="clientSecret">Client Secret:</label>
                  <input type="password" id="clientSecret" placeholder="OAuth2 Client Secretã‚’å…¥åŠ›" />
              </div>
              
              <!-- è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹URLè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
              <div id="generatedUrls" class="generated-urls" style="display: none;">
                  <div class="url-display">
                      <label>Token URL:</label>
                      <div id="displayTokenUrl" class="url-value">-</div>
                  </div>
                  <div class="url-display">
                      <label>API URL:</label>
                      <div id="displayApiUrl" class="url-value">-</div>
                  </div>
              </div>
              
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                  <button id="testSaasUrlBtn" class="test-btn" disabled>SaaS URLç¢ºèª</button>
                  <button id="getTokenBtn" class="oauth-btn">ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—</button>
                  <button id="oauth2RefreshBtn" class="refresh-btn" disabled>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—</button>
              </div>
              
              <div id="tokenStatus" class="token-status" style="display: none;">
                  <p><strong>ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³:</strong> <span id="tokenDisplay">æœªå–å¾—</span></p>
                  <p><strong>æœ‰åŠ¹æœŸé™:</strong> <span id="tokenExpiry">-</span></p>
              </div>
            
          </div>

          <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
          <div id="loadingIndicator" class="loading" style="display: none;">
              <p>å‡¦ç†ä¸­...</p>
          </div>

          <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
          <div id="errorMessage" class="error-message" style="display: none;"></div>

          <!-- å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
          <div class="output-section">
              <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ</h3>
              <div id="summaryInfo" class="summary-info" style="display: none;">
                <p><strong>ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:</strong> <span id="totalCount">0</span></p>
                <p><strong>ãƒšãƒ¼ã‚¸:</strong> <span id="currentPage">1</span> | <strong>ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º:</strong> <span id="pageSize">20</span></p>
                <p id="dataSource" style="margin: 0; font-style: italic;"></p>
                <p id="authMethod" style="margin: 0; font-weight: bold;"></p>
              </div>
              <div class="table-container">
                  <table id="userTable">
                    <thead>
                      <tr>
                        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</th>
                        <th>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
                        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                        <th>è¨€èªID</th>
                        <th>ä½œæˆæ—¥</th>
                        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</th>
                      </tr>
                    </thead>
                    <tbody id="userTableBody">
                      <tr>
                        <td colspan="7" class="no-data">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Liferay SaaS URLã‚’å…¥åŠ›ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚</td>
                      </tr>
                    </tbody>
                  </table>
              </div>
          </div>

          <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
          <div class="footer">
              <p>&copy; 2024 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  (Liferay SaaSå°‚ç”¨). All rights reserved.</p>
          </div>
      </div>
  </div>

  <script>
      // DOMè¦ç´ ã®å–å¾—
      const oauth2RefreshBtn = document.getElementById('oauth2RefreshBtn');
      const getTokenBtn = document.getElementById('getTokenBtn');
      const testSaasUrlBtn = document.getElementById('testSaasUrlBtn');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const errorMessage = document.getElementById('errorMessage');
      const userTableBody = document.getElementById('userTableBody');
      
      // OAuth2ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      const liferaySaasUrl = document.getElementById('liferaySaasUrl');
      const clientId = document.getElementById('clientId');
      const clientSecret = document.getElementById('clientSecret');
      const generatedUrls = document.getElementById('generatedUrls');
      const displayTokenUrl = document.getElementById('displayTokenUrl');
      const displayApiUrl = document.getElementById('displayApiUrl');
      const tokenStatus = document.getElementById('tokenStatus');
      const tokenDisplay = document.getElementById('tokenDisplay');
      const tokenExpiry = document.getElementById('tokenExpiry');

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let currentAccessToken = null;
      let tokenExpiryTime = null;
      let currentTokenUrl = '';
      let currentApiUrl = '';

      // Liferay SaaS URLå…¥åŠ›æ™‚ã®å‡¦ç†
      liferaySaasUrl.addEventListener('input', function() {
          const saasUrl = this.value.trim();
          
          if (saasUrl && isValidUrl(saasUrl)) {
              // URLã‚’è‡ªå‹•ç”Ÿæˆ
              const baseUrl = saasUrl.replace(/\/$/, '');
              currentTokenUrl = `${baseUrl}/o/oauth2/token`;
              currentApiUrl = `${baseUrl}/o/headless-admin-user/v1.0/user-accounts`;
              
              // è¡¨ç¤ºã‚’æ›´æ–°
              displayTokenUrl.textContent = currentTokenUrl;
              displayApiUrl.textContent = currentApiUrl;
              generatedUrls.style.display = 'block';
              testSaasUrlBtn.disabled = false;
          } else {
              generatedUrls.style.display = 'none';
              testSaasUrlBtn.disabled = true;
              currentTokenUrl = '';
              currentApiUrl = '';
          }
      });

      function isValidUrl(string) {
          try {
              new URL(string);
              return true;
          } catch (_) {
              return false;
          }
      }

      function showLoading() {
          loadingIndicator.style.display = 'block';
          errorMessage.style.display = 'none';
          oauth2RefreshBtn.disabled = true;
          getTokenBtn.disabled = true;
          testSaasUrlBtn.disabled = true;
      }

      function hideLoading() {
          loadingIndicator.style.display = 'none';
          if (currentAccessToken) {
              oauth2RefreshBtn.disabled = false;
          }
          getTokenBtn.disabled = false;
          if (liferaySaasUrl.value.trim()) {
              testSaasUrlBtn.disabled = false;
          }
      }

      function showError(message) {
          errorMessage.textContent = message;
          errorMessage.style.display = 'block';
          errorMessage.style.backgroundColor = '#ffebee';
          errorMessage.style.color = '#c62828';
          errorMessage.style.borderLeftColor = '#f44336';
      }

      function showSuccess(message) {
          errorMessage.textContent = message;
          errorMessage.style.display = 'block';
          errorMessage.style.backgroundColor = '#e8f5e8';
          errorMessage.style.color = '#2e7d32';
          errorMessage.style.borderLeftColor = '#4caf50';
      }

      function formatDate(dateString) {
          if (!dateString) return 'N/A';
          const date = new Date(dateString);
          if (isNaN(date.getTime())) return 'ç„¡åŠ¹ãªæ—¥ä»˜';
          
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}/${month}/${day}`;
      }

      function populateTable(users, responseData = {}) {
        const summaryInfo = document.getElementById('summaryInfo');
        const totalCount = document.getElementById('totalCount');
        const currentPage = document.getElementById('currentPage');
        const pageSize = document.getElementById('pageSize');
        const dataSource = document.getElementById('dataSource');
        const authMethod = document.getElementById('authMethod');

        if (!users || users.length === 0) {
          userTableBody.innerHTML = '<tr><td colspan="7" class="no-data">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</td></tr>';
          summaryInfo.style.display = 'none';
          return;
        }

        // ã‚µãƒãƒªãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
        totalCount.textContent = responseData.totalCount || users.length;
        currentPage.textContent = responseData.page || 1;
        pageSize.textContent = responseData.pageSize || users.length;
        
        // ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®è¡¨ç¤º
        if (responseData.source === 'mock-api') {
          dataSource.textContent = 'ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: ãƒ¢ãƒƒã‚¯APIï¼ˆãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ï¼‰';
          dataSource.style.color = '#ff9800';
        } else {
          dataSource.textContent = 'ğŸŒ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: Liferay SaaS API';
          dataSource.style.color = '#4caf50';
        }

        // èªè¨¼æ–¹æ³•ã®è¡¨ç¤º
        if (responseData.authMethod === 'OAuth2') {
          authMethod.textContent = 'ğŸ” èªè¨¼æ–¹æ³•: OAuth2 (Liferay SaaS)';
          authMethod.style.color = '#2196f3';
        } else {
          authMethod.textContent = '';
        }
        
        summaryInfo.style.display = 'block';

        const rows = users.map(user => {
          const lastLogin = user.lastLoginDate ? formatDate(user.lastLoginDate) : (user.hasLoginDate ? 'ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿' : 'ãƒ­ã‚°ã‚¤ãƒ³ãªã—');
          
          let statusText = user.status;
          if (user.status === 'Active') statusText = 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–';
          else if (user.status === 'Inactive') statusText = 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–';
          else if (user.status === 'Pending') statusText = 'ä¿ç•™ä¸­';

          return `
            <tr>
              <td>${user.id}</td>
              <td title="${user.emailAddress}">${user.emailAddress}</td>
              <td title="${user.alternateName}">${user.alternateName}</td>
              <td title="${user.languageId}">${user.languageId}</td>
              <td>${formatDate(user.dateCreated)}</td>
              <td><span class="status-${(user.status || '').toLowerCase()}">${statusText || 'N/A'}</span></td>
              <td title="${user.lastLoginDate || 'ãƒ­ã‚°ã‚¤ãƒ³æ—¥ãªã—'}">${lastLogin}</td>
            </tr>
          `;
        }).join('');

        userTableBody.innerHTML = rows;
      }

      // Liferay SaaS URLç¢ºèª
      async function testSaasUrl() {
          const saasUrl = liferaySaasUrl.value.trim();

          if (!saasUrl) {
              showError('Liferay SaaS URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
              return;
          }

          showLoading();

          try {
              
              
              const response = await fetch('/api/test-saas-url', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      saasUrl: saasUrl
                  })
              });

              const data = await response.json();

              if (data.success) {
                  showSuccess(`SaaS URLç¢ºèªæˆåŠŸ: ${data.message}`);
                  
                  // ç”Ÿæˆã•ã‚ŒãŸURLã‚’æ›´æ–°
                  if (data.generatedUrls) {
                      currentTokenUrl = data.generatedUrls.tokenUrl;
                      currentApiUrl = data.generatedUrls.apiUrl;
                      displayTokenUrl.textContent = currentTokenUrl;
                      displayApiUrl.textContent = currentApiUrl;
                  }
              } else {
                  let errorMsg = `SaaS URLç¢ºèªå¤±æ•—: ${data.error}`;
                  if (data.suggestion) {
                      errorMsg += `\n\n${data.suggestion}`;
                  }
                  showError(errorMsg);
              }
              
              
          } catch (error) {
              
              showError(`SaaS URLç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
          } finally {
              hideLoading();
          }
      }

      // OAuth2ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
      async function getOAuth2Token() {
          const clientIdValue = clientId.value.trim();
          const clientSecretValue = clientSecret.value.trim();

          if (!clientIdValue || !clientSecretValue || !currentTokenUrl) {
              showError('Client IDã€Client Secretã€ãŠã‚ˆã³Liferay SaaS URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
              return;
          }

          showLoading();

          try {
              
              
              const requestBody = {
                  clientId: clientIdValue,
                  clientSecret: clientSecretValue,
                  tokenUrl: currentTokenUrl,
                  grantType: 'client_credentials',
                  scope: 'Liferay.Headless.Admin.User.everything'
              };

              const response = await fetch('/api/oauth2-token', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(requestBody)
              });

              const data = await response.json();

              if (response.ok) {
                  currentAccessToken = data.access_token;
                  
                  // ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’è¨ˆç®—
                  if (data.expires_in) {
                      tokenExpiryTime = new Date(Date.now() + (data.expires_in * 1000));
                      tokenExpiry.textContent = tokenExpiryTime.toLocaleString('ja-JP');
                  } else {
                      tokenExpiry.textContent = 'ä¸æ˜';
                  }

                  // ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
                  tokenDisplay.textContent = `${currentAccessToken.substring(0, 20)}...`;
                  tokenStatus.style.display = 'block';
                  oauth2RefreshBtn.disabled = false;

                  showSuccess(`OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ­£å¸¸ã«å–å¾—ã—ã¾ã—ãŸã€‚æœ‰åŠ¹æœŸé™: ${data.expires_in ? data.expires_in + 'ç§’' : 'ä¸æ˜'}`);
              } else {
                  throw new Error(data.error || `HTTPã‚¨ãƒ©ãƒ¼! ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
              }
              
          } catch (error) {
              
              showError(`OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
              currentAccessToken = null;
              tokenStatus.style.display = 'none';
              oauth2RefreshBtn.disabled = true;
          } finally {
              hideLoading();
          }
      }

      // OAuth2ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆå–å¾—
      async function fetchUsersWithOAuth2() {
          if (!currentAccessToken) {
              showError('å…ˆã«OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚');
              return;
          }

          if (!currentApiUrl) {
              showError('Liferay SaaS URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
              return;
          }

          // ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯
          if (tokenExpiryTime && new Date() >= tokenExpiryTime) {
              showError('OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ã™ã€‚æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚');
              currentAccessToken = null;
              tokenStatus.style.display = 'none';
              oauth2RefreshBtn.disabled = true;
              return;
          }

          showLoading();

          try {
              
              
              const response = await fetch('/api/oauth2-user-list', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      accessToken: currentAccessToken,
                      apiUrl: currentApiUrl
                  })
              });

              

              const contentType = response.headers.get('content-type');
              

              if (!contentType || !contentType.includes('application/json')) {
                  const textResponse = await response.text();
                  
                  throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
              }

              const data = await response.json();

              if (!response.ok) {
                  if (response.status === 401) {
                      currentAccessToken = null;
                      tokenStatus.style.display = 'none';
                      oauth2RefreshBtn.disabled = true;
                  }
                  throw new Error(data.error || `HTTPã‚¨ãƒ©ãƒ¼! ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
              }

              populateTable(data.users, data);
              showSuccess(`Liferay SaaSã‹ã‚‰${data.users.length}äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ­£å¸¸ã«å–å¾—ã—ã¾ã—ãŸã€‚`);
              
          } catch (error) {
              
              showError(`Liferay SaaSã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
              userTableBody.innerHTML = '<tr><td colspan="7" class="no-data">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</td></tr>';
          } finally {
              hideLoading();
          }
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      oauth2RefreshBtn.addEventListener('click', fetchUsersWithOAuth2);
      getTokenBtn.addEventListener('click', getOAuth2Token);
      testSaasUrlBtn.addEventListener('click', testSaasUrl);

      // Enterã‚­ãƒ¼ã§å‡¦ç†ã‚’ãƒˆãƒªã‚¬ãƒ¼
      [liferaySaasUrl, clientId, clientSecret].forEach(input => {
          input.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') {
                  if (currentAccessToken) {
                      fetchUsersWithOAuth2();
                  } else if (liferaySaasUrl.value.trim() && clientId.value.trim() && clientSecret.value.trim()) {
                      getOAuth2Token();
                  } else if (liferaySaasUrl.value.trim()) {
                      testSaasUrl();
                  }
              }
          });
      });

      // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜
      function saveFormData() {
          localStorage.setItem('liferaySaasUrl', liferaySaasUrl.value);
          localStorage.setItem('clientId', clientId.value);
      }

      // localStorageã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      function loadFormData() {
          const savedSaasUrl = localStorage.getItem('liferaySaasUrl');
          const savedClientId = localStorage.getItem('clientId');

          if (savedSaasUrl) {
              liferaySaasUrl.value = savedSaasUrl;
              // URLå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ‰‹å‹•ã§ãƒˆãƒªã‚¬ãƒ¼
              liferaySaasUrl.dispatchEvent(new Event('input'));
          }
          if (savedClientId) clientId.value = savedClientId;
      }

      // å…¥åŠ›ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      [liferaySaasUrl, clientId].forEach(input => {
          input.addEventListener('input', saveFormData);
      });

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      loadFormData();
  </script>
</body>

</html>
